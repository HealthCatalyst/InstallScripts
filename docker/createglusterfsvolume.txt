#!/bin/sh
set -e
set -x

echo "Version 1.05"
#
# This script is meant for quick & easy install via:
#   curl -sSL https://healthcatalyst.github.io/InstallScripts/docker/createglusterfsvolume.txt | sh -s 


# get a list of all the nodes in this swarm
glusternodes=$(docker node ls --format '{{ .Hostname }}')

cmdText=""
linecount=0

while read -r line _; do
    linecount=$((linecount+1))
    echo "... $line ..."
    cmdText="$cmdText$line:/data/hcshared "
done <<< "$glusternodes"

echo "linecount=$linecount" 
echo "cmdtext=$cmdText"
sudo gluster volume create hcshared replica "$linecount" transport tcp "$cmdText" force

# sudo gluster volume stop hcshared
# sudo gluster volume delete hcshared

sudo gluster volume start hcshared

sudo gluster volume info


