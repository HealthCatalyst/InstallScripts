#!/bin/sh
set -e

echo "Version 1.02"
swarmmanager="$1"

if [[ -z "$swarmmanager" ]]; then
    echo "Must pass IP of swarm manager as a parameter"
    exit 1
fi

curl -L https://healthcatalyst.github.io/InstallScripts/docker/swarm_bash.txt >/tmp/swarm_bash.sh \
    && chmod +x /tmp/swarm_bash.sh \
    && sudo cp /tmp/swarm_bash.sh /usr/local/bin/swarm_bash.sh

curl -sSL https://healthcatalyst.github.io/InstallScripts/docker/installglusterfs.txt | sh -s 

# join the gluster
sudo gluster peer probe "$swarmmanager"

sudo gluster peer status

read -p "Hit enter after you've set up the master" -e foo < /dev/tty

myip=$(ip -4 addr show eth0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}')

sudo mount -t glusterfs $myip:/hcshared /mnt/hcshared

