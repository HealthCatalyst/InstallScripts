#!/bin/sh
set -e

echo "Version 1.04"
#
# This script is meant for quick & easy install via:
#   curl -sSL https://healthcatalyst.github.io/InstallScripts/docker/createglusterfsvolume.txt | sh -s 


# get a list of all the nodes in this swarm
glusternodes=$(docker node ls --format '{{ .Hostname }}')

cmdText=""
count=0

while read -r line _; do
    ((count++))
    echo "... $line ..."
    cmdText="$cmdText $line:/data/hcshared"
done <<< "$glusternodes"

echo "count=$count" 
echo "cmdtext=$cmdText"
sudo gluster volume create hcshared replica "$count" transport tcp "$cmdText" force

# sudo gluster volume stop hcshared
# sudo gluster volume delete hcshared

sudo gluster volume start hcshared

sudo gluster volume info


