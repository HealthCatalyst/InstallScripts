#!/bin/sh
set -e

echo "Version 1.07"

#
# This script is meant for quick & easy install via:
#   curl -sSL https://healthcatalyst.github.io/InstallScripts/docker/setupnode.txt | sh -s

curl -L https://healthcatalyst.github.io/InstallScripts/docker/swarm_bash.txt >/tmp/swarm_bash.sh \
    && chmod +x /tmp/swarm_bash.sh \
    && sudo cp /tmp/swarm_bash.sh /usr/local/bin/swarm_bash.sh

curl -sSL https://healthcatalyst.github.io/InstallScripts/docker/installglusterfs.txt | sh -s 

# join the gluster

read -p "Hit enter after you've finished setting up the master" -e foo < /dev/tty

sudo gluster peer status

myip=$(hostname)

sudo mount -t glusterfs $myip:/hcshared /mnt/hcshared

echo "reading the shared test file"
sudo cat /mnt/hcshared/test.txt

echo "Hello from $myip" | sudo tee -a /mnt/hcshared/test.txt
